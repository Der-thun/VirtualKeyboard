(()=>{"use strict";const e=new class{elements={main:null,keysContainer:null,title:null,textarea:null,description:null,language:null,keys:[]};events={oninput:null,onclose:null};properties={value:"",capsLock:!1,shift:!1,shiftReal:!1,alt:!1,altReal:!1,ctrl:!1,ctrlReal:!1,currentLanguage:"ru",dictRu:["ё","1","2","3","4","5","6","7","8","9","0","-","=","Backspace","Tab","й","ц","у","к","е","н","г","ш","щ","з","х","ъ","\\","Del","CapsLock","ф","ы","в","а","п","р","о","л","д","ж","э","Enter","ShiftL","я","ч","с","м","и","т","ь","б","ю",".","▲","ShiftR","CtrlL","Win","AltL","Space","AltR","◄","▼","►","CtrlR"],dictRuShiftFirstLine:{0:"Ё",1:"!",2:'"',3:"№",4:";",5:"%",6:":",7:"?",8:"*",9:"(",10:")",11:"",12:"+",27:"/",52:","},dictEn:["`","1","2","3","4","5","6","7","8","9","0","-","=","Backspace","Tab","q","w","e","r","t","y","u","i","o","p","[","]","\\","Del","CapsLock","a","s","d","f","g","h","j","k","l",";","'","Enter","ShiftL","z","x","c","v","b","n","m",",",".","/","▲","ShiftR","CtrlL","Win","AltL","Space","AltR","◄","▼","►","CtrlR"],dictEnShiftFirstLine:{0:"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",10:")",11:"",12:"+",25:"{",26:"}",27:"/",39:":",40:'"',50:"<",51:">",52:"?"},shiftRuCode:{Digit1:"!",Digit2:'"',Digit3:"№",Digit4:";",Digit5:"%",Digit6:":",Digit7:"?",Digit8:"*",Digit9:"(",Digit0:")",Minus:"",IntlYen:"+",Equal:"+",Slash:",",Backslash:"/"},shiftEnCode:{Backquote:"~",Digit1:"!",Digit2:"@",Digit3:"#",Digit4:"$",Digit5:"%",Digit6:"^",Digit7:"&",Digit8:"*",Digit9:"(",Digit0:")",Minus:"",IntlYen:"+",Equal:"+",Period:">",Comma:"<",Backslash:"|",BracketLeft:"{",BracketRight:"}",Semicolon:":",Quote:'"',Slash:"?"},unToggledKeys:["backspace","tab","del","capslock","enter","shift","ctrl","win","alt","space"],whichKeyRU:{220:"ё",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",48:"0",187:"-",219:"=",81:"й",87:"ц",69:"у",82:"к",84:"е",89:"н",85:"г",73:"ш",79:"щ",80:"з",221:"х",186:"ъ",191:"\\",65:"ф",83:"ы",68:"в",70:"а",71:"п",72:"р",74:"о",75:"л",76:"д",192:"ж",222:"э",90:"я",88:"ч",67:"с",86:"м",66:"и",78:"т",77:"ь",188:"б",190:"ю",189:".",38:"▲",37:"◄",40:"▼",39:"►"},whichKeyEN:{220:"`",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",48:"0",187:"-",219:"=",81:"q",87:"w",69:"e",82:"r",84:"t",89:"y",85:"u",73:"i",79:"o",80:"p",221:"[",186:"]",191:"\\",65:"a",83:"s",68:"d",70:"f",71:"g",72:"h",74:"j",75:"k",76:"l",192:";",222:"'",90:"z",88:"x",67:"c",86:"v",66:"b",78:"n",77:"m",188:",",190:".",189:"/",38:"▲",37:"◄",40:"▼",39:"►"},codeKey:{Backspace:"Backspace",Tab:"Tab",Delete:"Del",CapsLock:"CapsLock",Enter:"Enter",ShiftLeft:"Shift",ArrowUp:"Up",ShiftRight:"Shift",ControlLeft:"Ctrl",MetaLeft:"Win",AltLeft:"Alt",Space:"Space",AltRight:"Alt",ArrowLeft:"Left",ArrowDown:"Down",ControlRight:"Ctrl"}};init(){this.getLocalStorage(),this.elements.main=document.createElement("div"),this.elements.title=document.createElement("h1"),this.elements.textarea=document.createElement("textarea"),this.elements.keysContainer=document.createElement("div"),this.elements.description=document.createElement("p"),this.elements.language=document.createElement("p"),this.elements.main.classList.add("wrapper"),this.elements.title.classList.add("title"),this.elements.title.innerText="RSS Virtual Keyboard",this.elements.textarea.classList.add("input"),this.elements.textarea.autofocus=!0,this.elements.textarea.addEventListener("blur",(()=>{this.elements.textarea.focus()})),this.elements.keysContainer.classList.add("keyboard"),this.elements.keysContainer.appendChild(this.createKeys(this.properties.currentLanguage)),this.elements.keys=this.elements.keysContainer.querySelectorAll(".key"),this.elements.description.classList.add("description"),this.elements.description.innerText="Клавиатура создана в операционной системе Windows",this.elements.language.classList.add("language"),this.elements.language.innerText="Для переключения языка комбинация: левыe ctrl + alt",this.elements.main.appendChild(this.elements.title),this.elements.main.appendChild(this.elements.textarea),this.elements.main.appendChild(this.elements.keysContainer),this.elements.main.appendChild(this.elements.description),this.elements.main.appendChild(this.elements.language),document.body.appendChild(this.elements.main),this.keyPress()}createKeys(e){const t=document.createDocumentFragment();return("ru"===e?this.properties.dictRu:this.properties.dictEn).forEach((e=>{const t=document.createElement("button");switch(t.setAttribute("type","button"),t.classList.add("key"),t.textContent=e,e){case"Backspace":t.classList.add("back"),t.addEventListener("click",(()=>{this.backspaceKeyPress()})),this.properties.shift&&this.shift(),this.properties.alt&&this.altKeyPress(),this.properties.ctrl&&this.ctrlKeyPress();break;case"Tab":t.classList.add("m"),t.addEventListener("click",(()=>{this.tabKeyPress()})),this.properties.shift&&this.shift(),this.properties.alt&&this.altKeyPress(),this.properties.ctrl&&this.ctrlKeyPress();break;case"CapsLock":t.classList.add("xl","caps-acvivalible","caps"),t.addEventListener("click",(()=>{this.toggleCaps(),t.classList.toggle("caps-active")})),this.properties.alt&&this.altKeyPress(),this.properties.ctrl&&this.ctrlKeyPress();break;case"Enter":t.classList.add("xxl"),t.addEventListener("click",(()=>{this.enterKeyPress()})),this.properties.shift&&this.shift(),this.properties.alt&&this.altKeyPress(),this.properties.ctrl&&this.ctrlKeyPress();break;case"ShiftL":t.classList.add("xl","shiftleft"),t.textContent="Shift",t.addEventListener("click",(()=>{this.shift()})),this.properties.alt&&this.altKeyPress(),this.properties.ctrl&&this.ctrlKeyPress();break;case"ShiftR":t.classList.add("xl","shiftright"),t.textContent="Shift",t.addEventListener("click",(()=>{this.shift()})),this.properties.alt&&this.altKeyPress(),this.properties.ctrl&&this.ctrlKeyPress();break;case"CtrlL":t.classList.add("l","ctrlleft"),t.textContent="Ctrl",t.addEventListener("click",(()=>{this.ctrlKeyPress(),this.changeLanguage()}));break;case"CtrlR":t.classList.add("l","ctrlright"),t.textContent="Ctrl",this.properties.alt&&this.altKeyPress(),this.properties.ctrl&&this.ctrlKeyPress();break;case"Win":t.classList.add("l");break;case"AltL":t.classList.add("l","altleft"),t.textContent="Alt",t.addEventListener("click",(()=>{this.altKeyPress(),this.changeLanguage()}));break;case"AltR":t.classList.add("l","altright"),t.textContent="Alt",this.properties.alt&&this.altKeyPress(),this.properties.ctrl&&this.ctrlKeyPress();break;case"Space":t.classList.add("space"),t.addEventListener("click",(()=>{this.spaceKeyPress()})),this.properties.shift&&this.shift(),this.properties.alt&&this.altKeyPress(),this.properties.ctrl&&this.ctrlKeyPress();break;case"Del":t.addEventListener("click",(()=>{this.delKeyPress()})),this.properties.shift&&this.shift(),this.properties.alt&&this.altKeyPress(),this.properties.ctrl&&this.ctrlKeyPress();break;default:t.addEventListener("click",(e=>{this.defaultKeyPress(e),this.properties.shift&&this.shift(),this.properties.alt&&this.altKeyPress(),this.properties.ctrl&&this.ctrlKeyPress()}))}this.elements.keysContainer.appendChild(t)})),t}defaultKeyPress(e){const t=document.querySelector(".input"),s=t.selectionStart,i=t.selectionEnd,r=this.properties.value,a="ru"===this.properties.currentLanguage?this.properties.whichKeyRU:this.properties.whichKeyEN,l="ru"===this.properties.currentLanguage?this.properties.shiftRuCode:this.properties.shiftEnCode;let n;void 0!==l[e.code]?n=this.properties.shiftReal?l[e.code]:a[e.which]:e.target.classList.contains("key")&&(n=e.target.textContent),r.length+1!==s?this.properties.value=r.slice(0,s)+n+r.slice(i):this.properties.value+=n,t.value=this.properties.value,t.setSelectionRange(s+1,s+1)}backspaceKeyPress(){const e=document.querySelector(".input"),t=e.selectionStart,s=e.selectionEnd,i=this.properties.value;t===s?(i.length===t?this.properties.value=i.slice(0,i.length-1):this.properties.value=i.slice(0,t-1)+i.slice(s),e.value=this.properties.value,e.setSelectionRange(t-1,t-1)):(this.properties.value=i.slice(0,t)+i.slice(s),e.value=this.properties.value,e.setSelectionRange(t,t))}delKeyPress(){const e=document.querySelector(".input"),t=e.selectionStart,s=e.selectionEnd,i=this.properties.value;t===s?(this.properties.value=0===t?i.slice(1):i.slice(0,t)+i.slice(s+1),e.value=this.properties.value,e.setSelectionRange(t,t)):(this.properties.value=i.slice(0,t)+i.slice(s),e.value=this.properties.value,e.setSelectionRange(t,t))}enterKeyPress(){const e=document.querySelector(".input"),t=e.selectionStart,s=e.selectionEnd,i=this.properties.value;i.length+1!==t?this.properties.value=`${i.slice(0,t)}\n${i.slice(s)}`:this.properties.value+="\n",e.value=this.properties.value,e.setSelectionRange(t+1,t+1)}spaceKeyPress(){const e=document.querySelector(".input"),t=e.selectionStart,s=e.selectionEnd,i=this.properties.value;i.length+1!==t?this.properties.value=`${i.slice(0,t)} ${i.slice(s)}`:this.properties.value+=" ",e.value=this.properties.value,e.setSelectionRange(t+1,t+1)}tabKeyPress(){const e=document.querySelector(".input"),t=e.selectionStart,s=e.selectionEnd,i=this.properties.value;i.length+1!==t?this.properties.value=`${i.slice(0,t)}    ${i.slice(s)}`:this.properties.value+="    ",e.value=this.properties.value,e.setSelectionRange(t+4,t+4)}altKeyPress(){this.properties.alt=!this.properties.alt}ctrlKeyPress(){this.properties.ctrl=!this.properties.ctrl}shift(){if(this.properties.shift=!this.properties.shift,"ru"===this.properties.currentLanguage){for(const e in this.properties.dictRuShiftFirstLine)this.elements.keys[e].textContent===this.properties.dictRu[e]?this.elements.keys[e].textContent=this.properties.dictRuShiftFirstLine[e]:this.elements.keys[e].textContent=this.properties.dictRu[e];this.toggleCaps()}else{for(const e in this.properties.dictEnShiftFirstLine)this.elements.keys[e].textContent===this.properties.dictEn[e]?this.elements.keys[e].textContent=this.properties.dictEnShiftFirstLine[e]:this.elements.keys[e].textContent=this.properties.dictEn[e];this.toggleCaps()}}input(e){switch(e){case"write":document.querySelector(".input").value=this.properties.value;break;case"read":this.properties.value=document.querySelector(".input").value}}toggleCaps(){this.properties.capsLock=!this.properties.capsLock,this.elements.keys.forEach((e=>{this.properties.unToggledKeys.includes(e.innerText.toLowerCase())||(e.textContent=this.properties.capsLock?e.innerText.toUpperCase():e.innerText.toLowerCase())}))}keyPress(){document.querySelector(".input").addEventListener("keydown",(e=>{e.preventDefault();const t=document.querySelectorAll(".key"),s="ru"===this.properties.currentLanguage?this.properties.whichKeyRU:this.properties.whichKeyEN,i="ru"===this.properties.currentLanguage?this.properties.shiftRuCode:this.properties.shiftEnCode;t.forEach((t=>{if(this.properties.codeKey[e.code]===t.textContent)switch(t.textContent){case"Space":this.spaceKeyPress(),t.classList.add("active");break;case"Backspace":this.backspaceKeyPress(),t.classList.add("active");break;case"Enter":this.enterKeyPress(),t.classList.add("active");break;case"Shift":"ShiftLeft"===e.code?document.querySelector(".shiftleft").classList.add("active"):document.querySelector(".shiftright").classList.add("active"),this.properties.shiftReal||(this.properties.shiftReal=!0,this.shift());break;case"CapsLock":this.toggleCaps(),t.classList.toggle("caps-active"),t.classList.add("active");break;case"Tab":this.tabKeyPress(),t.classList.add("active");break;case"Ctrl":"ControlLeft"===e.code?(document.querySelector(".ctrlleft").classList.add("active"),this.properties.ctrlReal||(this.properties.ctrlReal=!0,this.changeLanguage())):document.querySelector(".ctrlright").classList.add("active"),this.ctrlKeyPress();break;case"Win":t.classList.add("active");break;case"Alt":"AltLeft"===e.code?(document.querySelector(".altleft").classList.add("active"),this.properties.altReal||(this.properties.altReal=!0,this.changeLanguage())):document.querySelector(".altright").classList.add("active"),this.altKeyPress();break;case"Del":this.delKeyPress(),t.classList.add("active")}else(t.textContent===i[e.code]||t.textContent.toLowerCase()===s[e.which])&&(this.defaultKeyPress(e),t.classList.add("active"))}))})),document.querySelector(".input").addEventListener("keyup",(e=>{const t=document.querySelectorAll(".key"),s="ru"===this.properties.currentLanguage?this.properties.whichKeyRU:this.properties.whichKeyEN,i="ru"===this.properties.currentLanguage?this.properties.shiftRuCode:this.properties.shiftEnCode;t.forEach((t=>{this.properties.codeKey[e.code]===t.textContent?(t.classList.remove("active"),this.properties.shift&&(this.shift(),this.properties.shiftReal=!1),this.properties.altReal=!1,this.properties.ctrlReal=!1):(t.textContent.toLowerCase()===s[e.which]||t.textContent===i[e.code])&&t.classList.remove("active")}))}))}changeLanguage(){if(this.properties.alt&&this.properties.ctrl||this.properties.altReal&&this.properties.ctrlReal){if("ru"===this.properties.currentLanguage){for(let e=0;e<this.elements.keys.length;e+=1){const t=this.elements.keys[e].textContent.toLowerCase();this.properties.unToggledKeys.includes(t)||(this.elements.keys[e].textContent=this.properties.capsLock?this.properties.dictEn[e].toUpperCase():this.properties.dictEn[e])}this.properties.currentLanguage="en"}else{for(let e=0;e<this.elements.keys.length;e+=1){const t=this.elements.keys[e].textContent.toLowerCase();this.properties.unToggledKeys.includes(t)||(this.elements.keys[e].textContent=this.properties.capsLock?this.properties.dictRu[e].toUpperCase():this.properties.dictRu[e])}this.properties.currentLanguage="ru"}this.setLocalStorage(),this.properties.alt=!1,this.properties.ctrl=!1,this.properties.altReal=!1,this.properties.ctrlReal=!1}}setLocalStorage(){localStorage.setItem("lang",this.properties.currentLanguage)}getLocalStorage(){localStorage.getItem("lang")&&(this.properties.currentLanguage=localStorage.getItem("lang"))}};window.addEventListener("DOMContentLoaded",(()=>{e.init()}))})();